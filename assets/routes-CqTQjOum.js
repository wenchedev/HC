import{u as W,j as e,b as Z,Q as J,M as X,a as ee,c as te,r as g,N as k,_ as I,d as ne,R as ae,e as re,f as oe,P as se,F as le,g as ce,h as ie,z as L,O as G,i as de,k as ue,l as me,I as pe,m as fe,n as he,B as j,C as ye,J as ge,p as R}from"./vendor-R6r_QWn1.js";import{P as xe,H as _e,F as be,u as z,D as je,c as Me,d as B,A as ve,s as i,M as Se,a as Ae,b as F,e as we,f as Ee,o as Ne}from"./components-CJUdAPl3.js";import{_ as Q}from"./lodash-DQi7RLTC.js";import{h as Ye}from"./moment-BLMuvzoS.js";import{a as q}from"./axios-B9ygI19o.js";function Pe(){const o=W();return e.jsxs("div",{className:"flex flex-column px-4 py-4",id:"error-page",children:[e.jsx("h1",{children:"Oops!"}),e.jsx("p",{children:"Sorry, an unexpected error has occurred."}),e.jsx("p",{children:e.jsx("i",{children:o.statusText||o.message})})]})}window._=Q;window.moment=Ye;window.Buffer=Z.Buffer;const H=o=>{var x,v;const t=(x=o.response)==null?void 0:x.data,l={style:{fontSize:"15px",whiteSpace:"nowrap !important",width:"auto"}};if(Array.isArray(t))Q.map(t,d=>{if(d.field&&d.detail)return L.error(d.detail,l)});else if(t!=null&&t.detail)return L.error(t.detail,l);if(t){const d={style:{height:"100px",width:"300px",fontSize:"15px"}};if(Object.keys(t).length===0&&((v=o.response)!=null&&v.status))return L.error(`Oops something went wrong.
 Error occurred on the server. 
 Please try again later.`,d)}},$e=new J({queryCache:new ee({onError:H}),mutationCache:new X({onError:H,onSuccess:o=>{}})});function Ce(){return e.jsx("div",{className:"flex flex-column gap-2 w-full h-full",children:e.jsx(G,{})})}function Te(){return e.jsx("div",{className:"flex w-full h-full",children:e.jsxs("div",{className:"flex flex-column w-full h-full",children:[e.jsx("div",{className:"flex flex-none w-full mb-5",children:e.jsx(_e,{})}),e.jsx("div",{className:"flex flex-column flex-grow-1 justify-content-center pl-4 pr-4",children:e.jsx(G,{})}),e.jsx("div",{className:"flex flex-none pt-5 w-full",children:e.jsx(be,{})})]})})}const ke=te([{element:e.jsx(Ce,{}),children:[{path:"",element:e.jsx(k,{replace:!0,to:"/login"})},{path:"/",element:e.jsx(k,{replace:!0,to:"/login"})},{path:"/login",Component:g.lazy(()=>I(()=>Promise.resolve().then(()=>ze),void 0))}]},{element:e.jsx(xe,{children:e.jsx(Te,{})}),errorElement:e.jsx(Pe,{}),children:[{path:"",element:e.jsx(k,{replace:!0,to:"/monthly-statement"})},{path:"/",element:e.jsx(k,{replace:!0,to:"/monthly-statement"})},{path:"/monthly-statement",Component:g.lazy(()=>I(()=>Promise.resolve().then(()=>He),void 0))}]}]);ne.createRoot(document.getElementById("root")).render(e.jsx(ae.StrictMode,{children:e.jsxs(re,{client:$e,children:[e.jsx(oe,{initialIsOpen:!1}),e.jsx(g.Suspense,{fallback:e.jsx("div",{className:"flex h-full w-full justify-content-center align-items-center",children:e.jsx(ie,{})}),children:e.jsxs(se,{children:[e.jsx(le,{position:"top-right",reverseOrder:!0,toastOptions:{className:"",duration:3e3,style:{height:"80px",width:"150px",fontSize:"18px"}}}),e.jsx(ce,{router:ke})]})})]})}));const U=()=>q.create({baseURL:"https://homecareapis.azurewebsites.net",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),De=q.create({baseURL:"https://homecareapis.azurewebsites.net"}),Oe=()=>de({mutationFn:async o=>{try{const{data:t}=await De.post("/api/users/login",o);return localStorage.setItem("token",t.token),localStorage.setItem("email",t.email),localStorage.setItem("mobile",t.mobile),localStorage.setItem("address",t.address),localStorage.setItem("name",t.first_name+" "+t.last_name),console.log(t),t}catch(t){return t}}}),Le=o=>ue({queryKey:["MONTHLY_WORKSHEET",o],queryFn:async()=>{const t=U(),{data:l}=await t.get(`rents/agent/${o}`);return l}}),Be=async(o,t,l)=>await Promise.all([l.get(`adminreport/${o}/${t}`),l.get(`/maintenances/property/${o}/${t}`),l.get(`/rents/property/${o}/${t}`)]),Ie=async(o,t,l)=>await Promise.all([l.get(`rents/property/year/report/${o}/${t}`),l.get(`maintenances/property/${o}`)]);function Re(){const[o,t]=g.useState(""),[l,x]=g.useState(""),[v,d]=g.useState(!1),[p,S]=g.useState(!1),C=me(),{mutate:T,isError:D}=Oe(),A=()=>{o&&l?(d(!1),T({email:o,password:l},{onSuccess:u=>{u!=null&&u.token?C("/monthly-statement"):S(!0)},onError:u=>{S(!0)}})):d(!0)};return e.jsxs("div",{className:"flex flex-column justify-content-center align-items-center gap-5 w-full h-full",children:[e.jsx(pe,{alt:"home-care-logo",width:"241",src:"/HC/201512office_logo.png"}),e.jsxs("div",{className:"flex flex-column gap-3",children:[e.jsxs("div",{className:"flex-row p-inputgroup w-30rem login-input-group",children:[e.jsx("span",{className:"p-inputgroup-addon",children:e.jsx("i",{className:"pi pi-user"})}),e.jsx(fe,{id:"username",value:o,onChange:u=>t(u.target.value),placeholder:"Email Address"})]}),e.jsxs("div",{className:"flex-row p-inputgroup w-30rem login-input-group",children:[e.jsx("span",{className:"p-inputgroup-addon",children:e.jsx("i",{className:"pi pi-key"})}),e.jsx(he,{icon:"pi pi-key",id:"password",value:l,onChange:u=>x(u.target.value),feedback:!1,placeholder:"Password",onKeyDown:u=>{(u==null?void 0:u.key)==="Enter"&&A()}})]})]}),e.jsxs("div",{className:"flex flex-column gap-3",children:[o&&l&&(p||D)?e.jsx("div",{className:"flex justify-content-center text-base",style:{color:"red"},children:"Log in failed: username or password is incorrect"}):null,v?e.jsx("div",{className:"flex justify-content-center text-base",style:{color:"red"},children:"Username or password can not be empty!"}):null,e.jsx(j,{icon:"pi pi-arrow-circle-right",iconPos:"right",label:"Sign in",outlined:!0,className:"w-30rem",onClick:()=>{A()}})]})]})}const ze=Object.freeze(Object.defineProperty({__proto__:null,default:Re},Symbol.toStringTag,{value:"Module"}));function Fe(){const[o,t]=g.useState({running:!1,done:0,total:0,label:""}),l=g.useRef({cancel:!1}),{setValue:x,resetState:v}=z(),d=z(n=>n.selectedMonth),{data:p,isFetching:S}=Le(moment(d).format("YYYY/M")),C=U();g.useEffect(()=>{!S&&(p==null?void 0:p.length)>0&&x({type:"SET_MONTHLY_DATA",location:"monthlyWorksheet",value:p})},[p]);const T=async({rows:n,kind:s})=>{l.current.cancel=!1;const c=(n||[]).filter(m=>m==null?void 0:m.property),b=c.length;t({running:!0,done:0,total:b,label:`Preparing ${s} PDFs...`});const y=Me(2),a=new ge;let f=0;const h=c.map(m=>y(async()=>{if(l.current.cancel)return;const _=s==="monthly"?await u(m.property):await A(m.property);!_||l.current.cancel||(a.file(_.filename,_.blob),f++,t(M=>({...M,done:f,label:`Built ${f}/${b}`})))}));if(await Promise.all(h),l.current.cancel){t({running:!1,done:0,total:0,label:""});return}t(m=>({...m,label:"Zipping..."}));const w=await a.generateAsync({type:"blob"}),E=s==="monthly"?moment(d).format("YYYY-MM"):moment(d).format("YYYY");B(w,`${s}-statements-${E}.zip`),t({running:!1,done:0,total:0,label:""})},D=()=>{l.current.cancel=!0},A=async n=>{var m,_,M;const s=moment(d).format("YYYY"),[{data:c},{data:b}]=await Ie(n,s,C),y=b.filter(r=>moment(r.maintenance_date).year()==moment(d).year());if(!(c!=null&&c.length))return null;const a=c.map(r=>ve({statement_date:moment.utc(r.rental_start).format("MMMM"),tenant_name:r.tenant,rent_start:moment.utc(r.rental_start).format("MMM DD"),rent_end:moment.utc(r.rental_end).format("MMM DD"),tenant_amount:i(r.tenant_amount),agent_amount:i(r.agent_amount+r.company_amount),cra_amount:i(r.cra),maintenance_amount:i(r.maintenance),landlord_amount:i(r.tenant_amount-r.agent_amount-r.company_amount-r.cra-r.maintenance)}));let f=null;(y==null?void 0:y.length)>0&&(f=y.map(r=>Se({date:moment.utc(r.maintenance_date).format("MMM DD, YYYY"),item:r.item,amount:i(r.amount)})));const h=Ae({title:`Landlord Property Yearly Statement - ${s}`,year:s,landlord_name:(m=c[0].property_docs)==null?void 0:m.landlord,landlord_address:c[0].prop_address,landlord_email:(_=c[0].property_docs)==null?void 0:_.email,property_address:c[0].prop_address,property_manager:c[0].agent_fullname,property_phone:(M=c[0].agent_docs)==null?void 0:M.mobile,monthly_record:a,maintenance_record:f??[]}),w=await R(e.jsx(we,{data:h})).toBlob(),E=`${F(h.property.address).slice(0,120)} - ${s} Statement.pdf`;return{blob:w,filename:E}},u=async n=>{var m,_,M;const s=moment(d).format("YYYY/M"),[{data:c},{data:b},{data:y}]=await Be(n,s,C),a=(c==null?void 0:c[0])??null,f=(y==null?void 0:y[0])??null,h={org:Ne(),title:"Landlord Property Monthly Statement",landlord:{name:((m=a==null?void 0:a.property_docs)==null?void 0:m.landlord)??"",address:(a==null?void 0:a.prop_address)??"",email:((_=a==null?void 0:a.property_docs)==null?void 0:_.email)??""},property:{address:(a==null?void 0:a.prop_address)??"",manager:(a==null?void 0:a.agent_fullname)??"",phone:((M=a==null?void 0:a.agent_docs)==null?void 0:M.mobile)??"",transactionDate:a!=null&&a.rental_start?moment.utc(a.rental_start).format("MMMM YYYY"):""},earnings:{current:{tenantAmount:0,agentAmount:0,gstAgent:0,craAmount:0,maintenance:0,landlordTotal:0},ytd:{tenantAmount:0,agentAmount:0,gstAgent:0,craAmount:0,maintenance:0,landlordTotal:0}},maintenanceDetails:[]};if(a){const r=(a.agent_amount??0)+(a.company_amount??0),N=r/1.05,O=r-N,Y=a.tenant_amount??0,P=a.cra??0,$=a.maintenance??0;h.earnings.current={tenantAmount:i(Y),agentAmount:i(N),gstAgent:i(O),craAmount:i(P),maintenance:i($),landlordTotal:i(Y-r-P-$)}}if(f){const r=(f.agent_amount??0)+(f.company_amount??0),N=r/1.05,O=r-N,Y=f.tenant_amount??0,P=f.cra??0,$=f.maintenance??0;h.earnings.ytd={tenantAmount:i(Y),agentAmount:i(N),gstAgent:i(O),craAmount:i(P),maintenance:i($),landlordTotal:i(Y-r-P-$)}}Array.isArray(b)&&b.length>0&&(h.maintenanceDetails=b.map(r=>({item:r.item??"",date:r.maintenance_date?moment.utc(r.maintenance_date).format("MMM DD, YYYY"):"",amountInclGst:i(r.amount??0)})));const w=await R(e.jsx(Ee,{data:h})).toBlob(),E=`${F(h.property.address).slice(0,120)} - ${h.property.transactionDate}.pdf`;return{blob:w,filename:E}},K=e.jsxs("div",{className:"flex py-3 gap-2 align-items-baseline",children:[e.jsx(j,{outlined:!0,icon:"pi pi-angle-left",onClick:()=>{x({type:"SET_SELECTED_MONTH",location:"selectedMonth",value:moment(d).subtract(1,"month").toDate()})}}),e.jsx(ye,{value:d,onChange:n=>{x({type:"SET_SELECTED_MONTH",location:"selectedMonth",value:n.value})},showIcon:!0,view:"month",dateFormat:"yy-mm"},"month_picker"),e.jsx(j,{outlined:!0,icon:"pi pi-angle-right",onClick:()=>{x({type:"SET_SELECTED_MONTH",location:"selectedMonth",value:moment(d).add(1,"month").toDate()})}}),e.jsx(j,{outlined:!0,label:o.running?o.label:"All Monthly",disabled:o.running,onClick:()=>T({rows:p,kind:"monthly"}),className:"ml-6",icon:"pi pi-download"},"all-monthly"),e.jsx(j,{outlined:!0,label:o.running?o.label:"All Yearly",severity:"success",disabled:o.running,onClick:()=>T({rows:p,kind:"yearly"}),className:"ml-3",icon:"pi pi-download"},"all-yearly"),o.running&&e.jsx(j,{outlined:!0,severity:"danger",label:"Cancel",className:"ml-3",onClick:D})]}),V=[{field:"report",header:"Report",sortable:!1,filter:!1,body:n=>e.jsxs("div",{className:"flex justify-content-center",children:[e.jsx(j,{outlined:!0,label:"Monthly",onClick:async()=>{const{blob:s,filename:c}=await u(n.property);B(s,c)},disabled:!n.property},n.property+"month"),e.jsx(j,{outlined:!0,label:"Yearly",severity:"success",className:"ml-2",disabled:!n.property,onClick:async()=>{const{blob:s,filename:c}=await A(n.property);B(s,c)}},n.property+"year")]})},{field:"address_landlord",header:"Property [Landlord]: Address",body:n=>{var s;return`[${(s=n==null?void 0:n.property_docs)==null?void 0:s.landlord}]: ${n==null?void 0:n.prop_address}`}},{field:"rent_date",header:"Rent Date",formatter:"date"},{field:"landlord",header:"Landlord",body:n=>{var s;return`${(s=n==null?void 0:n.property_docs)==null?void 0:s.landlord}`}},{field:"agent_amount_due",header:"Due to Agent($)",body:n=>`${n==null?void 0:n.agent_amount}`},{field:"tenant",header:"Tenant"},{field:"tenant_amount",header:"Tenant($)"},{field:"landlord_amount",header:"Landord($)"},{field:"agent_amount",header:"Agent($)"},{field:"maintenance",header:"Maintenance($)"},{field:"company_amount",header:"Company($)"},{field:"cra",header:"CRA($)"},{field:"landlord_account",header:"Landlord Account",body:n=>{var s;return`${(s=n==null?void 0:n.property_docs)==null?void 0:s.account}`}},{field:"rental_start",header:"Rental Start",formatter:"date"},{field:"rental_end",header:"Rental End",formatter:"date"},{field:"note",header:"Note"}];return e.jsxs("div",{className:"flex flex-column w-full h-full align-items-start",children:[e.jsx("div",{className:"w-full text-5xl font-bold",children:"Rent Management"}),e.jsx("div",{className:"w-full mt-5 gap-2 min-w-0",children:e.jsx(je,{className:"w-full",value:(p==null?void 0:p.length)>0?p:[],columns:V,injectHeader:K,overrides:{style:{width:"100%"},tableStyle:{width:"max-content"},scrollable:!0,loading:S,emptyMessage:"No records found."}})})]})}const He=Object.freeze(Object.defineProperty({__proto__:null,default:Fe},Symbol.toStringTag,{value:"Module"}));
