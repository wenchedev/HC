import{u as G,j as e,Q as z,M as F,a as H,z as _,c as B,r as p,N as x,_ as R,b as U,R as q,d as Q,e as W,P as K,F as V,f as J,g as X,O as k,h as Z,i as ee,k as te,I as ne,l as ae,m as re,B as j,C as se,p as oe}from"./vendor-Cb66zzGM.js";import{P as le,H as ie,F as ce,u as y,m as de,D as ue,s as c,a as me,b as pe,M as he}from"./components-CEjqLMwM.js";import{_ as D}from"./lodash-DMHljLiY.js";import{h as fe}from"./moment-BLMuvzoS.js";import{a as L}from"./axios-B9ygI19o.js";function ge(){const n=G();return e.jsxs("div",{className:"flex flex-column px-4 py-4",id:"error-page",children:[e.jsx("h1",{children:"Oops!"}),e.jsx("p",{children:"Sorry, an unexpected error has occurred."}),e.jsx("p",{children:e.jsx("i",{children:n.statusText||n.message})})]})}window._=D;window.moment=fe;const $=n=>{var l,m;const a=(l=n.response)==null?void 0:l.data,o={style:{fontSize:"15px",whiteSpace:"nowrap !important",width:"auto"}};if(Array.isArray(a))D.map(a,u=>{if(u.field&&u.detail)return _.error(u.detail,o)});else if(a!=null&&a.detail)return _.error(a.detail,o);if(a){const u={style:{height:"100px",width:"300px",fontSize:"15px"}};if(Object.keys(a).length===0&&((m=n.response)!=null&&m.status))return _.error(`Oops something went wrong.
 Error occurred on the server. 
 Please try again later.`,u)}},xe=new z({queryCache:new H({onError:$}),mutationCache:new F({onError:$,onSuccess:n=>{var l,m;const a={style:{fontSize:"15px",whiteSpace:"nowrap !important",width:"auto"}};let o="Record Saved";if(n!=null&&n.responseMsg?o=n.responseMsg:(l=n==null?void 0:n.data)!=null&&l.responseMsg&&(o=n.data.responseMsg),n.identifier||(m=n.data)!=null&&m.identifier)return _.success(o,a)}})});function ye(){return e.jsx("div",{className:"flex flex-column gap-2 w-full h-full",children:e.jsx(k,{})})}function _e(){return e.jsx("div",{className:"flex w-full h-full",children:e.jsxs("div",{className:"flex flex-column w-full h-full",children:[e.jsx("div",{className:"flex flex-none w-full mb-5",children:e.jsx(ie,{})}),e.jsx("div",{className:"flex flex-column flex-grow-1 justify-content-center pl-4 pr-4",children:e.jsx(k,{})}),e.jsx("div",{className:"flex flex-none pt-5 w-full",children:e.jsx(ce,{})})]})})}const je=B([{element:e.jsx(ye,{}),children:[{path:"",element:e.jsx(x,{replace:!0,to:"/login"})},{path:"/",element:e.jsx(x,{replace:!0,to:"/login"})},{path:"/login",Component:p.lazy(()=>R(()=>Promise.resolve().then(()=>Ee),void 0))}]},{element:e.jsx(le,{children:e.jsx(_e,{})}),errorElement:e.jsx(ge,{}),children:[{path:"",element:e.jsx(x,{replace:!0,to:"/monthly-statement"})},{path:"/",element:e.jsx(x,{replace:!0,to:"/monthly-statement"})},{path:"/monthly-statement",Component:p.lazy(()=>R(()=>Promise.resolve().then(()=>Ae),void 0))}]}]);U.createRoot(document.getElementById("root")).render(e.jsx(q.StrictMode,{children:e.jsxs(Q,{client:xe,children:[e.jsx(W,{initialIsOpen:!1}),e.jsx(p.Suspense,{fallback:e.jsx("div",{className:"flex h-full w-full justify-content-center align-items-center",children:e.jsx(X,{})}),children:e.jsxs(K,{children:[e.jsx(V,{position:"top-right",reverseOrder:!0,toastOptions:{className:"",duration:3e3,style:{height:"80px",width:"150px",fontSize:"18px"}}}),e.jsx(J,{router:je})]})})]})}));const Y=()=>L.create({baseURL:"https://homecareapis.azurewebsites.net",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),ve=L.create({baseURL:"https://homecareapis.azurewebsites.net"}),be=()=>Z({mutationFn:async n=>{try{const{data:a}=await ve.post("/api/users/login",n);return localStorage.setItem("token",a.token),localStorage.setItem("email",a.email),localStorage.setItem("mobile",a.mobile),localStorage.setItem("address",a.address),localStorage.setItem("name",a.first_name+" "+a.last_name),console.log(a),a}catch{}}}),Me=n=>ee({queryKey:["MONTHLY_WORKSHEET",n],queryFn:async()=>{const a=Y(),{data:o}=await a.get(`rents/agent/${n}`);return o}});function Se(){const[n,a]=p.useState(""),[o,l]=p.useState(""),[m,u]=p.useState(!1),v=te(),{mutate:b}=be(),g=()=>{n&&o?(u(!1),b({email:n,password:o},{onSuccess:t=>{t!=null&&t.token&&v("/monthly-statement")}})):u(!0)};return e.jsxs("div",{className:"flex flex-column justify-content-center align-items-center gap-5 w-full h-full",children:[e.jsx(ne,{alt:"home-care-logo",width:"241",src:"/HC/201512office_logo.png"}),e.jsxs("div",{className:"flex flex-column gap-3",children:[e.jsxs("div",{className:"flex-row p-inputgroup w-30rem login-input-group",children:[e.jsx("span",{className:"p-inputgroup-addon",children:e.jsx("i",{className:"pi pi-user"})}),e.jsx(ae,{id:"username",value:n,onChange:t=>a(t.target.value),placeholder:"Email Address"})]}),e.jsxs("div",{className:"flex-row p-inputgroup w-30rem login-input-group",children:[e.jsx("span",{className:"p-inputgroup-addon",children:e.jsx("i",{className:"pi pi-key"})}),e.jsx(re,{icon:"pi pi-key",id:"password",value:o,onChange:t=>l(t.target.value),feedback:!1,placeholder:"Password",onKeyDown:t=>{(t==null?void 0:t.key)==="Enter"&&g()}})]})]}),e.jsxs("div",{className:"flex flex-column gap-3",children:[null,m?e.jsx("div",{className:"flex justify-content-center text-base",style:{color:"red"},children:"Username or password can not be empty!"}):null,e.jsx(j,{icon:"pi pi-arrow-circle-right",iconPos:"right",label:"Sign in",outlined:!0,className:"w-30rem",onClick:()=>{g()}})]})]})}const Ee=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"}));function Ne(){const{setValue:n,resetState:a}=y(),o=y(t=>t.selectedMonth);y(t=>t.monthlyWorksheet),y(t=>t.monthlyDataMapped);const{data:l,isFetching:m}=Me(moment(o).format("YYYY/M")),u=Y();p.useEffect(()=>{if(!m&&(l==null?void 0:l.length)>0){const t=l.map(d=>de(d));n({type:"SET_MAPPED_MONTHLY_DATA",location:"monthlyDataMapped",value:t}),n({type:"SET_MONTHLY_DATA",location:"monthlyWorksheet",value:l})}},[l]);async function v(t,d){const[{data:r},{data:h},{data:i}]=await Promise.all([u.get(`adminreport/${t}/${d}`),u.get(`/maintenances/property/${t}/${d}`),u.get(`/rents/property/${t}/${d}`)]);return{adminreportData:r,maintenancesData:h,rentsData:i}}const b=async(t,d)=>{var N,A,w;const{adminreportData:r,maintenancesData:h,rentsData:i}=await v(t,moment(o).format("YYYY/M")),s=pe();if((r==null?void 0:r.length)>0){if(s.landlord.name=(N=r[0].property_docs)==null?void 0:N.landlord,s.landlord.email=(A=r[0].property_docs)==null?void 0:A.email,s.landlord.address=r[0].prop_address,s.property.address=r[0].prop_address,s.statement.transactionDate=moment.utc(r[0].rental_start).format("MMMM YYYY"),s.statement.transactionNumber=null,s.statement.propertyManager=r[0].agent_fullname,s.statement.telephone=(w=r[0].agent_docs)==null?void 0:w.mobile,(i==null?void 0:i.length)>0){const f=r[0].agent_amount+r[0].company_amount,S=(r[0].agent_amount+r[0].company_amount)/1.05,T=f-S,P=i[0].agent_amount+i[0].company_amount,E=(i[0].agent_amount+i[0].company_amount)/1.05,O=P-E;s.earnings.rows=[{label:"Tenant Amount:",currentAmount:c(r[0].tenant_amount),currentGst:null,ytdAmount:c(i[0].tenant_amount),ytdGst:null},{label:"Agent Amount:",currentAmount:c(S),currentGst:c(T),ytdAmount:c(E),ytdGst:c(O)},{label:"CRA Amount:",currentAmount:c(r[0].cra),currentGst:null,ytdAmount:c(i[0].cra),ytdGst:null},{label:"Maintenance:",currentAmount:c(r[0].maintenance),currentGst:null,ytdAmount:c(i[0].maintenance),ytdGst:null}],s.earnings.netCurrentAmount=c(r[0].tenant_amount-S-(r[0].cra??0)-(r[0].maintenance??0)),s.earnings.netCurrentGst=c(T),s.earnings.landlordTotalCurrent=c(r[0].tenant_amount-f-(r[0].cra??0)-(r[0].maintenance??0)),s.earnings.netYtdAmount=c(i[0].tenant_amount-E-(i[0].cra??0)-(i[0].maintenance??0)),s.earnings.netYtdGst=c(O),s.earnings.landlordTotalYtd=c(i[0].tenant_amount-P-(i[0].cra??0)-(i[0].maintenance??0))}(h==null?void 0:h.length)>0&&(s.items=h.map(f=>({amountInclGst:f.amount,description:f.item,month:moment.utc(f.maintenance_date).format("YYYY/MMM/DD")})));const I=await oe(e.jsx(he,{data:s})).toBlob(),C=URL.createObjectURL(I),M=document.createElement("a");M.href=C,M.download=`${me(s.property.address).slice(0,120)} - ${s.statement.transactionDate}.pdf`,M.click(),URL.revokeObjectURL(C)}},g=[{field:"report",header:"Report",body:t=>e.jsx("div",{className:"flex justify-content-center",children:e.jsx(j,{outlined:!0,label:"Monthly",onClick:()=>{b(t.property,t.agent)},disabled:t.property==null},t.property+"month")})},{field:"address_landlord",header:"Property [Landlord]: Address",body:t=>{var d;return`[${(d=t==null?void 0:t.property_docs)==null?void 0:d.landlord}]: ${t==null?void 0:t.prop_address}`}},{field:"rent_date",header:"Rent Date",formatter:"date"},{field:"landlord",header:"Landlord",body:t=>{var d;return`${(d=t==null?void 0:t.property_docs)==null?void 0:d.landlord}`}},{field:"agent_amount_due",header:"Due to Agent($)",body:t=>`${t==null?void 0:t.agent_amount}`},{field:"tenant",header:"Tenant"},{field:"tenant_amount",header:"Tenant($)"},{field:"landlord_amount",header:"Landord($)"},{field:"agent_amount",header:"Agent($)"},{field:"maintenance",header:"Maintenance($)"},{field:"company_amount",header:"Company($)"},{field:"cra",header:"CRA($)"},{field:"landlord_account",header:"Landlord Account",body:t=>{var d;return`${(d=t==null?void 0:t.property_docs)==null?void 0:d.account}`}},{field:"rental_start",header:"Rental Start",formatter:"date"},{field:"rental_end",header:"Rental End",formatter:"date"},{field:"note",header:"Note"}];return e.jsxs("div",{className:"flex flex-column w-full h-full align-items-start",children:[e.jsx("div",{className:"w-full text-6xl font-bold",children:"Rent Management"}),e.jsx("div",{className:"w-full mt-5 gap-2 min-w-0",children:e.jsx(ue,{className:"w-full",value:(l==null?void 0:l.length)>0?l:[],columns:g,injectHeader:e.jsx("div",{className:"flex py-3 gap-2 align-items-baseline",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{outlined:!0,icon:"pi pi-angle-left",onClick:()=>{n({type:"SET_SELECTED_MONTH",location:"selectedMonth",value:moment(o).subtract(1,"month").toDate()})}}),e.jsx(se,{id:"month_picker",value:o,onChange:t=>{n({type:"SET_SELECTED_MONTH",location:"selectedMonth",value:t.value})},showIcon:!0,view:"month",dateFormat:"yy-mm"}),e.jsx(j,{outlined:!0,icon:"pi pi-angle-right",onClick:()=>{n({type:"SET_SELECTED_MONTH",location:"selectedMonth",value:moment(o).add(1,"month").toDate()})}})]})}),overrides:{style:{width:"100%"},tableStyle:{width:"max-content"},scrollable:!0,loading:m}})})]})}const Ae=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));
