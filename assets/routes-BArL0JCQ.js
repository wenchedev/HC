import{u as I,j as e,Q as G,M as z,a as F,z as y,c as H,r as p,N as g,_ as R,b as B,R as U,d as q,e as Q,P as W,F as K,f as V,g as J,O as k,h as X,i as Z,k as ee,I as te,l as ne,m as ae,B as _,C as re,p as se}from"./vendor-Djw7SOHW.js";import{P as oe,H as le,F as ie,u as x,m as ce,D as de,s as d,a as ue,b as me,M as pe}from"./components-Vsee4uZM.js";import{_ as D}from"./lodash-jniZkpK9.js";import{h as he}from"./moment-BLMuvzoS.js";import{a as L}from"./axios-B9ygI19o.js";function fe(){const n=I();return e.jsxs("div",{className:"flex flex-column px-4 py-4",id:"error-page",children:[e.jsx("h1",{children:"Oops!"}),e.jsx("p",{children:"Sorry, an unexpected error has occurred."}),e.jsx("p",{children:e.jsx("i",{children:n.statusText||n.message})})]})}window._=D;window.moment=he;const $=n=>{var l,u;const r=(l=n.response)==null?void 0:l.data,c={style:{fontSize:"15px",whiteSpace:"nowrap !important",width:"auto"}};if(Array.isArray(r))D.map(r,m=>{if(m.field&&m.detail)return y.error(m.detail,c)});else if(r!=null&&r.detail)return y.error(r.detail,c);if(r){const m={style:{height:"100px",width:"300px",fontSize:"15px"}};if(Object.keys(r).length===0&&((u=n.response)!=null&&u.status))return y.error(`Oops something went wrong.
 Error occurred on the server. 
 Please try again later.`,m)}},ge=new G({queryCache:new F({onError:$}),mutationCache:new z({onError:$,onSuccess:n=>{var l,u;const r={style:{fontSize:"15px",whiteSpace:"nowrap !important",width:"auto"}};let c="Record Saved";if(n!=null&&n.responseMsg?c=n.responseMsg:(l=n==null?void 0:n.data)!=null&&l.responseMsg&&(c=n.data.responseMsg),n.identifier||(u=n.data)!=null&&u.identifier)return y.success(c,r)}})});function xe(){return e.jsx("div",{className:"flex flex-column gap-2 w-full h-full",children:e.jsx(k,{})})}function ye(){return e.jsx("div",{className:"flex w-full h-full",children:e.jsxs("div",{className:"flex flex-column w-full h-full",children:[e.jsx("div",{className:"flex flex-none w-full mb-5",children:e.jsx(le,{})}),e.jsx("div",{className:"flex flex-column flex-grow-1 justify-content-center pl-4 pr-4",children:e.jsx(k,{})}),e.jsx("div",{className:"flex flex-none pt-5 w-full",children:e.jsx(ie,{})})]})})}const _e=H([{element:e.jsx(xe,{}),children:[{path:"",element:e.jsx(g,{replace:!0,to:"/login"})},{path:"/",element:e.jsx(g,{replace:!0,to:"/login"})},{path:"/login",Component:p.lazy(()=>R(()=>Promise.resolve().then(()=>Se),void 0))}]},{element:e.jsx(oe,{children:e.jsx(ye,{})}),errorElement:e.jsx(fe,{}),children:[{path:"",element:e.jsx(g,{replace:!0,to:"/monthly-statement"})},{path:"/",element:e.jsx(g,{replace:!0,to:"/monthly-statement"})},{path:"/monthly-statement",Component:p.lazy(()=>R(()=>Promise.resolve().then(()=>Ne),void 0))}]}]);B.createRoot(document.getElementById("root")).render(e.jsx(U.StrictMode,{children:e.jsxs(q,{client:ge,children:[e.jsx(Q,{initialIsOpen:!1}),e.jsx(p.Suspense,{fallback:e.jsx("div",{className:"flex h-full w-full justify-content-center align-items-center",children:e.jsx(J,{})}),children:e.jsxs(W,{children:[e.jsx(K,{position:"top-right",reverseOrder:!0,toastOptions:{className:"",duration:3e3,style:{height:"80px",width:"150px",fontSize:"18px"}}}),e.jsx(V,{router:_e})]})})]})}));const j=L.create({baseURL:"https://homecareapis.azurewebsites.net",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),je=L.create({baseURL:"https://homecareapis.azurewebsites.net"}),ve=()=>X({mutationFn:async n=>{try{const{data:r}=await je.post("/api/users/login",n);return localStorage.setItem("token",r.token),localStorage.setItem("email",r.email),localStorage.setItem("mobile",r.mobile),localStorage.setItem("address",r.address),localStorage.setItem("name",r.first_name+" "+r.last_name),console.log(r),r}catch{}}}),be=n=>Z({queryKey:["MONTHLY_WORKSHEET",n],queryFn:async()=>{const{data:r}=await j.get(`rents/agent/${n}`);return r}});function Me(){const[n,r]=p.useState(""),[c,l]=p.useState(""),[u,m]=p.useState(!1),v=ee(),{mutate:b}=ve(),t=()=>{n&&c?(m(!1),b({email:n,password:c},{onSuccess:a=>{a!=null&&a.token&&v("/monthly-statement")}})):m(!0)};return e.jsxs("div",{className:"flex flex-column justify-content-center align-items-center gap-5 w-full h-full",children:[e.jsx(te,{alt:"home-care-logo",width:"241",src:"/201512office_logo.png"}),e.jsxs("div",{className:"flex flex-column gap-3",children:[e.jsxs("div",{className:"flex-row p-inputgroup w-30rem login-input-group",children:[e.jsx("span",{className:"p-inputgroup-addon",children:e.jsx("i",{className:"pi pi-user"})}),e.jsx(ne,{id:"username",value:n,onChange:a=>r(a.target.value),placeholder:"Email Address"})]}),e.jsxs("div",{className:"flex-row p-inputgroup w-30rem login-input-group",children:[e.jsx("span",{className:"p-inputgroup-addon",children:e.jsx("i",{className:"pi pi-key"})}),e.jsx(ae,{icon:"pi pi-key",id:"password",value:c,onChange:a=>l(a.target.value),feedback:!1,placeholder:"Password",onKeyDown:a=>{(a==null?void 0:a.key)==="Enter"&&t()}})]})]}),e.jsxs("div",{className:"flex flex-column gap-3",children:[null,u?e.jsx("div",{className:"flex justify-content-center text-base",style:{color:"red"},children:"Username or password can not be empty!"}):null,e.jsx(_,{icon:"pi pi-arrow-circle-right",iconPos:"right",label:"Sign in",outlined:!0,className:"w-30rem",onClick:()=>{t()}})]})]})}const Se=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"}));function Ee(){const{setValue:n,resetState:r}=x(),c=x(t=>t.selectedMonth);x(t=>t.monthlyWorksheet),x(t=>t.monthlyDataMapped);const{data:l,isFetching:u}=be(moment(c).format("YYYY/M"));p.useEffect(()=>{if(!u&&(l==null?void 0:l.length)>0){const t=l.map(a=>ce(a));n({type:"SET_MAPPED_MONTHLY_DATA",location:"monthlyDataMapped",value:t}),n({type:"SET_MONTHLY_DATA",location:"monthlyWorksheet",value:l})}},[l]);async function m(t,a){const[{data:s},{data:h},{data:i}]=await Promise.all([j.get(`adminreport/${t}/${a}`),j.get(`/maintenances/property/${t}/${a}`),j.get(`/rents/property/${t}/${a}`)]);return{adminreportData:s,maintenancesData:h,rentsData:i}}const v=async(t,a)=>{var N,A,w;const{adminreportData:s,maintenancesData:h,rentsData:i}=await m(t,moment(c).format("YYYY/M")),o=me();if((s==null?void 0:s.length)>0){if(o.landlord.name=(N=s[0].property_docs)==null?void 0:N.landlord,o.landlord.email=(A=s[0].property_docs)==null?void 0:A.email,o.landlord.address=s[0].prop_address,o.property.address=s[0].prop_address,o.statement.transactionDate=moment.utc(s[0].rental_start).format("MMMM YYYY"),o.statement.transactionNumber=null,o.statement.propertyManager=s[0].agent_fullname,o.statement.telephone=(w=s[0].agent_docs)==null?void 0:w.mobile,(i==null?void 0:i.length)>0){const f=s[0].agent_amount+s[0].company_amount,S=(s[0].agent_amount+s[0].company_amount)/1.05,C=f-S,P=i[0].agent_amount+i[0].company_amount,E=(i[0].agent_amount+i[0].company_amount)/1.05,O=P-E;o.earnings.rows=[{label:"Tenant Amount:",currentAmount:d(s[0].tenant_amount),currentGst:null,ytdAmount:d(i[0].tenant_amount),ytdGst:null},{label:"Agent Amount:",currentAmount:d(S),currentGst:d(C),ytdAmount:d(E),ytdGst:d(O)},{label:"CRA Amount:",currentAmount:d(s[0].cra),currentGst:null,ytdAmount:d(i[0].cra),ytdGst:null},{label:"Maintenance:",currentAmount:d(s[0].maintenance),currentGst:null,ytdAmount:d(i[0].maintenance),ytdGst:null}],o.earnings.netCurrentAmount=d(s[0].tenant_amount-S-(s[0].cra??0)-(s[0].maintenance??0)),o.earnings.netCurrentGst=d(C),o.earnings.landlordTotalCurrent=d(s[0].tenant_amount-f-(s[0].cra??0)-(s[0].maintenance??0)),o.earnings.netYtdAmount=d(i[0].tenant_amount-E-(i[0].cra??0)-(i[0].maintenance??0)),o.earnings.netYtdGst=d(O),o.earnings.landlordTotalYtd=d(i[0].tenant_amount-P-(i[0].cra??0)-(i[0].maintenance??0))}(h==null?void 0:h.length)>0&&(o.items=h.map(f=>({amountInclGst:f.amount,description:f.item,month:moment.utc(f.maintenance_date).format("YYYY/MMM/DD")})));const Y=await se(e.jsx(pe,{data:o})).toBlob(),T=URL.createObjectURL(Y),M=document.createElement("a");M.href=T,M.download=`${ue(o.property.address).slice(0,120)} - ${o.statement.transactionDate}.pdf`,M.click(),URL.revokeObjectURL(T)}},b=[{field:"report",header:"Report",body:t=>e.jsx("div",{className:"flex justify-content-center",children:e.jsx(_,{outlined:!0,label:"Monthly",onClick:()=>{v(t.property,t.agent)},disabled:t.property==null},t.property+"month")})},{field:"address_landlord",header:"Property [Landlord]: Address",body:t=>{var a;return`[${(a=t==null?void 0:t.property_docs)==null?void 0:a.landlord}]: ${t==null?void 0:t.prop_address}`}},{field:"rent_date",header:"Rent Date",formatter:"date"},{field:"landlord",header:"Landlord",body:t=>{var a;return`${(a=t==null?void 0:t.property_docs)==null?void 0:a.landlord}`}},{field:"agent_amount_due",header:"Due to Agent($)",body:t=>`${t==null?void 0:t.agent_amount}`},{field:"tenant",header:"Tenant"},{field:"tenant_amount",header:"Tenant($)"},{field:"landlord_amount",header:"Landord($)"},{field:"agent_amount",header:"Agent($)"},{field:"maintenance",header:"Maintenance($)"},{field:"company_amount",header:"Company($)"},{field:"cra",header:"CRA($)"},{field:"landlord_account",header:"Landlord Account",body:t=>{var a;return`${(a=t==null?void 0:t.property_docs)==null?void 0:a.account}`}},{field:"rental_start",header:"Rental Start",formatter:"date"},{field:"rental_end",header:"Rental End",formatter:"date"},{field:"note",header:"Note"}];return e.jsxs("div",{className:"flex flex-column w-full h-full align-items-start",children:[e.jsx("div",{className:"w-full text-6xl font-bold",children:"Rent Management"}),e.jsx("div",{className:"w-full mt-5 gap-2 min-w-0",children:e.jsx(de,{className:"w-full",value:(l==null?void 0:l.length)>0?l:[],columns:b,injectHeader:e.jsx("div",{className:"flex py-3 gap-2 align-items-baseline",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{outlined:!0,icon:"pi pi-angle-left",onClick:()=>{n({type:"SET_SELECTED_MONTH",location:"selectedMonth",value:moment(c).subtract(1,"month").toDate()})}}),e.jsx(re,{id:"month_picker",value:c,onChange:t=>{n({type:"SET_SELECTED_MONTH",location:"selectedMonth",value:t.value})},showIcon:!0,view:"month",dateFormat:"yy-mm"}),e.jsx(_,{outlined:!0,icon:"pi pi-angle-right",onClick:()=>{n({type:"SET_SELECTED_MONTH",location:"selectedMonth",value:moment(c).add(1,"month").toDate()})}})]})}),overrides:{style:{width:"100%"},tableStyle:{width:"max-content"},scrollable:!0,loading:u}})})]})}const Ne=Object.freeze(Object.defineProperty({__proto__:null,default:Ee},Symbol.toStringTag,{value:"Module"}));
