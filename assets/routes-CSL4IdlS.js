import{u as Ee,j as n,b as Ye,Q as ke,M as Te,a as Pe,c as De,r as y,N as J,_ as ce,d as Ne,R as $e,e as Ce,f as Oe,P as Be,F as Ie,g as Re,h as Le,z as $,O as ge,i as ze,k as Fe,l as Ge,I as He,m as Ke,n as Qe,B as N,C as qe,J as Ue,p as de}from"./vendor-ByMbCiu8.js";import{P as We,H as Je,F as Ve,u as ne,r as me,D as Ze,G as Xe,E as et,s as tt,g as nt,n as at,d as C,c as ue,a as pe,b as fe,e as rt,f as st,h as lt,A as ot,i as b,M as it,j as ct,k as ye,l as dt,m as mt,o as ut}from"./components-BG1IbpM5.js";import{_ as be}from"./lodash-BZ4_jr_E.js";import{h as pt}from"./moment-BLMuvzoS.js";import{a as ae}from"./axios-B9ygI19o.js";function ft(){const u=Ee();return n.jsxs("div",{className:"flex flex-column px-4 py-4",id:"error-page",children:[n.jsx("h1",{children:"Oops!"}),n.jsx("p",{children:"Sorry, an unexpected error has occurred."}),n.jsx("p",{children:n.jsx("i",{children:u.statusText||u.message})})]})}window._=be;window.moment=pt;window.Buffer=Ye.Buffer;const he=u=>{var f,h;const d=(f=u.response)==null?void 0:f.data,x={style:{fontSize:"15px",whiteSpace:"nowrap !important",width:"auto"}};if(Array.isArray(d))be.map(d,A=>{if(A.field&&A.detail)return $.error(A.detail,x)});else if(d!=null&&d.detail)return $.error(d.detail,x);if(d){const A={style:{height:"100px",width:"300px",fontSize:"15px"}};if(Object.keys(d).length===0&&((h=u.response)!=null&&h.status))return $.error(`Oops something went wrong.
 Error occurred on the server. 
 Please try again later.`,A)}},yt=new ke({queryCache:new Pe({onError:he}),mutationCache:new Te({onError:he,onSuccess:u=>{}})});function ht(){return n.jsx("div",{className:"flex flex-column gap-2 w-full h-full",children:n.jsx(ge,{})})}function gt(){return n.jsx("div",{className:"flex w-full h-full",children:n.jsxs("div",{className:"flex flex-column w-full h-full",children:[n.jsx("div",{className:"flex flex-none w-full mb-5",children:n.jsx(Je,{})}),n.jsx("div",{className:"flex flex-column flex-grow-1 justify-content-center pl-4 pr-4",children:n.jsx(ge,{})}),n.jsx("div",{className:"flex flex-none pt-5 w-full",children:n.jsx(Ve,{})})]})})}const bt=De([{element:n.jsx(ht,{}),children:[{path:"",element:n.jsx(J,{replace:!0,to:"/login"})},{path:"/",element:n.jsx(J,{replace:!0,to:"/login"})},{path:"/login",Component:y.lazy(()=>ce(()=>Promise.resolve().then(()=>At),void 0))}]},{element:n.jsx(We,{children:n.jsx(gt,{})}),errorElement:n.jsx(ft,{}),children:[{path:"",element:n.jsx(J,{replace:!0,to:"/monthly-statement"})},{path:"/",element:n.jsx(J,{replace:!0,to:"/monthly-statement"})},{path:"/monthly-statement",Component:y.lazy(()=>ce(()=>Promise.resolve().then(()=>Yt),void 0))}]}]);Ne.createRoot(document.getElementById("root")).render(n.jsx($e.StrictMode,{children:n.jsxs(Ce,{client:yt,children:[n.jsx(Oe,{initialIsOpen:!1}),n.jsx(y.Suspense,{fallback:n.jsx("div",{className:"flex h-full w-full justify-content-center align-items-center",children:n.jsx(Le,{})}),children:n.jsxs(Be,{children:[n.jsx(Ie,{position:"top-right",reverseOrder:!0,toastOptions:{className:"",duration:3e3,style:{height:"80px",width:"150px",fontSize:"18px"}}}),n.jsx(Re,{router:bt})]})})]})}));const xe=()=>ae.create({baseURL:"https://homecareapis.azurewebsites.net",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),xt=ae.create({baseURL:"https://homecareapis.azurewebsites.net"}),_t=u=>ae.create({baseURL:"https://www.googleapis.com/gmail/v1/",headers:{Authorization:`Bearer ${u}`}}),jt=()=>ze({mutationFn:async u=>{try{const{data:d}=await xt.post("/api/users/login",u);return localStorage.setItem("token",d.token),localStorage.setItem("email",d.email),localStorage.setItem("mobile",d.mobile),localStorage.setItem("address",d.address),localStorage.setItem("name",d.first_name+" "+d.last_name),d}catch(d){return d}}}),wt=u=>Fe({queryKey:["MONTHLY_WORKSHEET",u,localStorage.getItem("email")],queryFn:async()=>{const d=xe(),{data:x}=await d.get(`rents/agent/${u}`);return x},staleTime:1500*1e3,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1}),Mt=async(u,d,x)=>await Promise.all([x.get(`adminreport/${u}/${d}`),x.get(`/maintenances/property/${u}/${d}`),x.get(`/rents/property/${u}/${d}`)]),vt=async(u,d,x)=>await Promise.all([x.get(`rents/property/year/report/${u}/${d}`),x.get(`maintenances/property/${u}`)]);function St(){const{setValue:u,resetState:d}=ne(),[x,f]=y.useState(""),[h,A]=y.useState(""),[L,z]=y.useState(!1),[F,G]=y.useState(!1),H=Ge(),{mutate:K,isError:Y}=jt(),v=()=>{x&&h?(z(!1),K({email:x,password:h},{onSuccess:w=>{w!=null&&w.token?H("/monthly-statement"):G(!0)},onError:w=>{G(!0)}})):z(!0)};return n.jsxs("div",{className:"flex flex-column justify-content-center align-items-center gap-5 w-full h-full",children:[n.jsx(He,{alt:"home-care-logo",width:"241",src:"/HC/201512office_logo.png"}),n.jsxs("div",{className:"flex flex-column gap-3",children:[n.jsxs("div",{className:"flex-row p-inputgroup w-30rem login-input-group",children:[n.jsx("span",{className:"p-inputgroup-addon",children:n.jsx("i",{className:"pi pi-user"})}),n.jsx(Ke,{id:"username",value:x,onChange:w=>f(w.target.value),placeholder:"Email Address"})]}),n.jsxs("div",{className:"flex-row p-inputgroup w-30rem login-input-group",children:[n.jsx("span",{className:"p-inputgroup-addon",children:n.jsx("i",{className:"pi pi-key"})}),n.jsx(Qe,{icon:"pi pi-key",id:"password",value:h,onChange:w=>A(w.target.value),feedback:!1,placeholder:"Password",onKeyDown:w=>{(w==null?void 0:w.key)==="Enter"&&v()}})]})]}),n.jsxs("div",{className:"flex flex-column gap-3",children:[x&&h&&(F||Y)?n.jsx("div",{className:"flex justify-content-center text-base",style:{color:"red"},children:"Log in failed: username or password is incorrect"}):null,L?n.jsx("div",{className:"flex justify-content-center text-base",style:{color:"red"},children:"Username or password can not be empty!"}):null,n.jsx(N,{icon:"pi pi-arrow-circle-right",iconPos:"right",label:"Sign in",outlined:!0,className:"w-30rem",onClick:()=>{v()}})]})]})}const At=Object.freeze(Object.defineProperty({__proto__:null,default:St},Symbol.toStringTag,{value:"Module"}));function Et(){const u={style:{fontSize:"15px",whiteSpace:"nowrap !important",width:"auto"}},{setValue:d,resetState:x}=ne(),f=ne(e=>e.selectedMonth),{data:h,isFetching:A}=wt(moment(f).format("YYYY/M")),L=xe(),[z,F]=y.useState(!1),[G,H]=y.useState(!1),[K,Y]=y.useState([]),[v,w]=y.useState("monthly"),[_e,re]=y.useState(!1),[je,we]=y.useState(null),[E,V]=y.useState(null),[S,Q]=y.useState(null),k=y.useRef(null),[T,j]=y.useState({running:!1,done:0,total:0,label:""}),P=y.useRef({cancel:!1});y.useEffect(()=>{!A&&(h==null?void 0:h.length)>0&&d({type:"SET_MONTHLY_DATA",location:"monthlyWorksheet",value:h})},[h]),y.useEffect(()=>(Y([]),Y()),[v,f]),y.useEffect(()=>()=>{k.current&&clearTimeout(k.current),S&&me(S)},[S]);const Me=e=>new Promise(t=>setTimeout(t,e)),q=(e,t)=>{e&&Y(a=>(a||[]).map(l=>l.id!==e?l:{...l,status:{...l.status||{},...t.state?{state:t.state}:{},...t.error!==void 0?{error:t.error}:{},...t.sentAt!==void 0?{sentAt:t.sentAt}:{}},email:{...l.email||{},...t.messageId!==void 0?{messageId:t.messageId}:{}}}))};async function se({list:e,gmailToken:t,delayMs:a=1e3,onProgress:l,onItemStatus:s}){let r=0,c=0;for(let m=0;m<e.length;m++){const g=e[m];s==null||s(g.id,{state:"sending",error:null,sentAt:null});const M=Z(g);try{const o=await ue({to:E||"wenchendev@gmail.com",subject:M.subject,htmlBody:M.html,pdfBlob:g.blob,filename:g.filename}),p=await fetch("https://gmail.googleapis.com/gmail/v1/users/me/messages/send",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({raw:o})});if(!p.ok){const i=await p.text();c++,s==null||s(g.id,{state:"failed",error:i});break}const _=await p.json();r++,$.success("Email has been sent to: "+g.to,u),s==null||s(g.id,{state:"sent",sentAt:Date.now(),messageId:_==null?void 0:_.id})}catch(o){c++,s==null||s(g.id,{state:"failed",error:String(o)}),$.error("Failed to send "+M.subject,u);break}l==null||l({index:m+1,total:e.length}),await Me(a)}return{sent:r,failed:c}}const O=y.useRef(new Map),U=({kind:e,propertyID:t,label:a})=>`${e}:${t}:${a||""}`,W=({kind:e,propertyID:t,built:a,label:l})=>{var M,o,p;if(!(a!=null&&a.blob)||!(a!=null&&a.filename))return;const s=((M=a.meta)==null?void 0:M.landlordEmail)||"",r=((o=a.meta)==null?void 0:o.landlordName)||"",c=((p=a.meta)==null?void 0:p.propertyAddress)||"",m=U({kind:e,propertyID:t,label:l}),g={blob:a.blob,filename:a.filename,to:s,landlordName:r,address:c,propertyID:t,kind:e,label:l,createdAt:Date.now()};return O.current.set(m,g),g},le=({kind:e,propertyID:t,label:a})=>{const l=U({kind:e,propertyID:t,label:a});return O.current.has(l)},ve=()=>Array.from(O.current.values()),oe=async({rows:e,kind:t})=>{P.current.cancel=!1;const a=(e||[]).filter(o=>o==null?void 0:o.property),l=a.length;j({running:!0,done:0,total:l,label:`Preparing ${t} PDFs...`});const s=fe(2),r=new Ue;let c=0;const m=a.map(o=>s(async()=>{var _;if(P.current.cancel)return;const p=t==="monthly"?await ee(o.property):await X(o.property);!p||P.current.cancel||(r.file(p.filename,p.blob),W({kind:t,propertyID:o.property,built:p,label:(_=p.meta)==null?void 0:_.label}),c++,j(i=>({...i,done:c,label:`Built ${c}/${l}`})))}));if(await Promise.all(m),P.current.cancel){j({running:!1,done:0,total:0,label:""});return}j(o=>({...o,label:"Zipping..."}));const g=await r.generateAsync({type:"blob"}),M=t==="monthly"?moment(f).format("YYYY-MM"):moment(f).format("YYYY");C(g,`${t}-statements-${M}.zip`),j({running:!1,done:0,total:0,label:""})},ie=()=>{P.current.cancel=!0},Z=e=>{const t=st({...e});return lt(t)},X=async e=>{var o,p,_;const t=moment(f).format("YYYY"),[{data:a},{data:l}]=await vt(e,t,L),s=l.filter(i=>moment(i.maintenance_date).year()==moment(f).year());if(!(a!=null&&a.length))return null;const r=a.map(i=>ot({statement_date:moment.utc(i.rental_start).format("MMMM"),tenant_name:i.tenant,rent_start:moment.utc(i.rental_start).format("MMM DD"),rent_end:moment.utc(i.rental_end).format("MMM DD"),tenant_amount:b(i.tenant_amount),agent_amount:b(i.agent_amount+i.company_amount),cra_amount:b(i.cra),maintenance_amount:b(i.maintenance),landlord_amount:b(i.tenant_amount-i.agent_amount-i.company_amount-i.cra-i.maintenance)}));let c=null;(s==null?void 0:s.length)>0&&(c=s.map(i=>it({date:moment.utc(i.maintenance_date).format("MMM DD, YYYY"),item:i.item,amount:b(i.amount)})));const m=ct({title:`Landlord Property Yearly Statement - ${t}`,year:t,landlord_name:(o=a[0].property_docs)==null?void 0:o.landlord,landlord_address:a[0].prop_address,landlord_email:(p=a[0].property_docs)==null?void 0:p.email,property_address:a[0].prop_address,property_manager:a[0].agent_fullname,property_phone:(_=a[0].agent_docs)==null?void 0:_.mobile,monthly_record:r,maintenance_record:c??[]}),g=await de(n.jsx(dt,{data:m})).toBlob(),M=`${ye(m.property.address).slice(0,120)} - ${t} Statement.pdf`;return{blob:g,filename:M,meta:{landlordEmail:m.landlord.email||"",landlordName:m.landlord.name||"",propertyAddress:m.property.address||"",label:t}}},ee=async e=>{var o,p,_;const t=moment(f).format("YYYY/M"),[{data:a},{data:l},{data:s}]=await Mt(e,t,L),r=(a==null?void 0:a[0])??null,c=(s==null?void 0:s[0])??null,m={org:ut(),title:"Landlord Property Monthly Statement",landlord:{name:((o=r==null?void 0:r.property_docs)==null?void 0:o.landlord)??"",address:(r==null?void 0:r.prop_address)??"",email:((p=r==null?void 0:r.property_docs)==null?void 0:p.email)??""},property:{address:(r==null?void 0:r.prop_address)??"",manager:(r==null?void 0:r.agent_fullname)??"",phone:((_=r==null?void 0:r.agent_docs)==null?void 0:_.mobile)??"",transactionDate:r!=null&&r.rental_start?moment.utc(r.rental_start).format("MMMM YYYY"):""},earnings:{current:{tenantAmount:0,agentAmount:0,gstAgent:0,craAmount:0,maintenance:0,landlordTotal:0},ytd:{tenantAmount:0,agentAmount:0,gstAgent:0,craAmount:0,maintenance:0,landlordTotal:0}},maintenanceDetails:[]};if(r){const i=(r.agent_amount??0)+(r.company_amount??0),D=i/1.05,te=i-D,B=r.tenant_amount??0,I=r.cra??0,R=r.maintenance??0;m.earnings.current={tenantAmount:b(B),agentAmount:b(D),gstAgent:b(te),craAmount:b(I),maintenance:b(R),landlordTotal:b(B-i-I-R)}}if(c){const i=(c.agent_amount??0)+(c.company_amount??0),D=i/1.05,te=i-D,B=c.tenant_amount??0,I=c.cra??0,R=c.maintenance??0;m.earnings.ytd={tenantAmount:b(B),agentAmount:b(D),gstAgent:b(te),craAmount:b(I),maintenance:b(R),landlordTotal:b(B-i-I-R)}}Array.isArray(l)&&l.length>0&&(m.maintenanceDetails=l.map(i=>({item:i.item??"",date:i.maintenance_date?moment.utc(i.maintenance_date).format("MMM DD, YYYY"):"",amountInclGst:b(i.amount??0)})));const g=await de(n.jsx(mt,{data:m})).toBlob(),M=`${ye(m.property.address).slice(0,120)} - ${m.property.transactionDate}.pdf`;return{blob:g,filename:M,meta:{landlordEmail:m.landlord.email||"",landlordName:m.landlord.name||"",propertyAddress:m.property.address||"",label:moment(f).format("MMMM YYYY")}}},Se=n.jsxs("div",{className:"flex py-3 gap-2 align-items-baseline",children:[n.jsx(N,{outlined:!0,icon:"pi pi-angle-left",onClick:()=>{d({type:"SET_SELECTED_MONTH",location:"selectedMonth",value:moment(f).subtract(1,"month").toDate()})}},"prev-month"),n.jsx(qe,{value:f,onChange:e=>{d({type:"SET_SELECTED_MONTH",location:"selectedMonth",value:e.value})},showIcon:!0,view:"month",dateFormat:"yy-mm"},"month_picker"),n.jsx(N,{outlined:!0,icon:"pi pi-angle-right",onClick:()=>{d({type:"SET_SELECTED_MONTH",location:"selectedMonth",value:moment(f).add(1,"month").toDate()})}},"next-month"),n.jsx(N,{outlined:!0,label:T.running?T.label:"All Monthly PDFs",disabled:T.running,onClick:()=>oe({rows:h,kind:"monthly"}),className:"ml-6",icon:"pi pi-download"},"all-monthly"),n.jsx(N,{outlined:!0,label:T.running?T.label:"All Yearly PDFs",severity:"success",disabled:T.running,onClick:()=>oe({rows:h,kind:"yearly"}),className:"ml-3",icon:"pi pi-download"},"all-yearly"),T.running&&n.jsx(N,{outlined:!0,severity:"danger",label:"Cancel",className:"ml-3",onClick:ie}),n.jsx(N,{outlined:!0,icon:"pi pi-file-export",label:"Create Bulk Email",severity:"warning",disabled:T.running,onClick:()=>{H(!0)},className:"ml-3"},"bulk-email")]}),Ae=[{field:"report",header:"Download Statement",sortable:!1,filter:!1,body:e=>n.jsxs("div",{className:"flex justify-content-center",children:[n.jsx(N,{outlined:!0,label:"Monthly",onClick:async()=>{const t="monthly",a=e.property,l=moment(f).format("YYYY/M"),s=U({kind:t,propertyID:a,label:l}),r=O.current.get(s);if(le({kind:t,propertyID:a,label:l})&&(r!=null&&r.blob))C(r.blob,r.filename);else{const c=await ee(e.property);if(!c)return;W({kind:t,propertyID:a,built:c,label:l}),C(c.blob,c.filename)}},disabled:!e.property},e.property+"month"),n.jsx(N,{outlined:!0,label:"Yearly",severity:"success",className:"ml-2",disabled:!e.property,onClick:async()=>{const t="yearly",a=e.property,l=moment(f).format("YYYY"),s=U({kind:t,propertyID:a,label:l}),r=O.current.get(s);if(le({kind:t,propertyID:a,label:l})&&(r!=null&&r.blob))C(r.blob,r.filename);else{const c=await X(e.property);if(!c)return;W({kind:t,propertyID:a,built:c,label:l}),C(c.blob,c.filename)}}},e.property+"year")]})},{field:"address_landlord",header:"Property [Landlord]: Address",body:e=>{var t;return`[${(t=e==null?void 0:e.property_docs)==null?void 0:t.landlord}]: ${e==null?void 0:e.prop_address}`}},{field:"rent_date",header:"Rent Date",formatter:"date"},{field:"landlord",header:"Landlord",body:e=>{var t;return`${(t=e==null?void 0:e.property_docs)==null?void 0:t.landlord}`}},{field:"agent_amount_due",header:"Due to Agent($)",body:e=>`${e==null?void 0:e.agent_amount}`},{field:"tenant",header:"Tenant"},{field:"tenant_amount",header:"Tenant($)"},{field:"landlord_amount",header:"Landord($)"},{field:"agent_amount",header:"Agent($)"},{field:"maintenance",header:"Maintenance($)"},{field:"company_amount",header:"Company($)"},{field:"cra",header:"CRA($)"},{field:"landlord_account",header:"Landlord Account",body:e=>{var t;return`${(t=e==null?void 0:e.property_docs)==null?void 0:t.account}`}},{field:"rental_start",header:"Rental Start",formatter:"date"},{field:"rental_end",header:"Rental End",formatter:"date"},{field:"note",header:"Note"}];return n.jsxs("div",{className:"flex flex-column w-full h-full align-items-start",children:[n.jsx("div",{className:"w-full text-5xl font-bold",children:"Rent Management"}),n.jsx("div",{className:"w-full mt-5 gap-2 min-w-0",children:n.jsx(Ze,{className:"w-full",value:(h==null?void 0:h.length)>0?h:[],columns:Ae,injectHeader:Se,overrides:{style:{width:"100%"},tableStyle:{width:"max-content"},scrollable:!0,loading:A,emptyMessage:"No records found."}})}),n.jsx(Xe,{visible:z,onHide:()=>{F(!1)},onToken:async e=>{if(console.log(e),e.access_token){Q(e.access_token),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{Q(null)},(e.expires_in-60)*1e3);const{data:t}=await _t(e.access_token).get("users/me/profile");console.log(t),V(t==null?void 0:t.emailAddress)}else console.log("missing access_token")}}),n.jsx(et,{visible:G,onHide:()=>{H(!1),Y([])},gmailToken:S,connectedGmail:E,onOAuthClick:()=>{S?(k.current&&clearTimeout(k.current),me(S),Q(null),V(null)):F(!0)},kind:v,onKindChange:w,items:K,bulk:T,onCancelBulk:ie,onBuildAll:async()=>{P.current.cancel=!1;const e=v=="monthly"?moment(f).format("MMMM YYYY"):moment(f).format("YYYY"),t=ve().filter(o=>o.kind===v&&o.label==e),a=new Set(t.map(o=>o.propertyID)),l=t.map(o=>pe({...o,status:{state:"ready"},id:o.propertyID+"-"+o.label})),s=(h||[]).filter(o=>o==null?void 0:o.property),r=s.filter(o=>!a.has(o.property)),c=s.length;let m=l.length;j({running:!0,done:m,total:c,label:`Preparing ${v} PDFs...`}),Y(l);const g=fe(2),M=r.map(o=>g(async()=>{var i;if(P.current.cancel)return;const p=v==="monthly"?await ee(o.property):await X(o.property);if(!p||P.current.cancel)return;const _=W({kind:v,propertyID:o.property,built:p,label:(i=p.meta)==null?void 0:i.label});m++,Y(D=>[...D,pe({..._,status:{state:"ready"},id:_.propertyID+"-"+_.label})]),j(D=>({...D,done:m,label:`Built ${m}/${c}`}))}));if(await Promise.all(M),P.current.cancel){j({running:!1,done:0,total:0,label:""});return}j({running:!1,done:0,total:0,label:""})},onSendAll:async e=>{if(!S){alert("Gmail not authenticated");return}const t=e!=null&&e.length?e:K;j({running:!0,done:0,total:t.length,label:"Sending emails…"});const a=await se({list:t,gmailToken:S,delayMs:1e3,onProgress:({index:l})=>j(s=>({...s,done:l})),onItemStatus:(l,s)=>q(l,s)});j({running:!1,label:`Done — ${a.sent} sent, ${a.failed} failed`})},onSendOne:async e=>{if(S){q(e.id,{state:"sending",error:null});try{await se({list:[e],gmailToken:S,delayMs:0,onItemStatus:(t,a)=>q(t,a)})}catch(t){q(e.id,{state:"failed",error:String(t)})}}},onTestOne:async e=>{const t=Z(e),a=await ue({to:E,subject:t.subject,htmlBody:t.html,pdfBlob:e.blob,filename:e.filename});return(await fetch("https://gmail.googleapis.com/gmail/v1/users/me/messages/send",{method:"POST",headers:{Authorization:`Bearer ${S}`,"Content-Type":"application/json"},body:JSON.stringify({raw:a})})).ok?$.success("Testing email has been sent to: "+E,u):$.error("Failed to send "+t.subject,u)},onPreviewOne:async e=>{const t=Z(e);we({to:E||"wenchendev@gmail.com",from:E,subject:t.subject,htmlBody:t.html,pdfBlob:e.blob,filename:e.filename}),re(!0)},onDownloadOne:e=>{C(e.blob,e.filename)},onCheckStatus:async e=>{var t;j({running:!0,label:"Checking emails…",type:"check"});try{const a=await tt({gmailToken:S,emailAddresses:e.map(l=>E||"wenchendev@gmail.com"),subjectPrefix:v=="monthly"?moment(f).format("MMMM YYYY")+" Monthly Statement for":moment(f).format("YYYY")+" Annual Report",maxMessagesToScan:2e3,metadataConcurrency:4});j({running:!1,label:"",type:null}),Y(l=>(l||[]).map(s=>{const r=nt({kind:v,label:s.label,address:s.address}),c=at(r),m=a.bySubject[c];return m?{...s,status:{...s.status||{},state:"sent",sentAt:m.latestSentDate},email:{...s.email||{}}}:s}))}catch(a){j({running:!1,label:"",type:null}),(t=a.message)!=null&&t.includes('"code": 401')?(k.current&&clearTimeout(k.current),Q(null),V(null),$.error("Failed to connect the Gmail, please re-connect and try again",u)):$.error("Failed to check status, please try again later ",u)}}}),n.jsx(rt,{visible:_e,onHide:()=>re(!1),preview:je})]})}const Yt=Object.freeze(Object.defineProperty({__proto__:null,default:Et},Symbol.toStringTag,{value:"Module"}));
